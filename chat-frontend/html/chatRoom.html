<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../bootstrap/css/bootstrap.min.css">
    <script src="../js/jquery-3.4.1.js"></script>
    <script src="../js/time/moment.js"></script>
    <title>FSE Chat Room</title>
</head>
<style>
    .container-fluid {
        display: flex;
        flex-direction: column;
        /*-webkit-box-orient: vertical;*/
        /*-webkit-box-direction: normal;*/
        justify-content: space-between;
        align-items: center;
    }

    .name {
        margin-top: 20px;
        margin-bottom: 20px;
    }

    .top {
        width: 80%;
        border: 1px solid #000000;
        border-radius: 20px;
        flex: 1;

    }

    .info {
        /*padding-left: 20px;*/
        padding: 5px;
    }

    ul li {
        font-size: 30px;
        /*background: image();*/
    }

    .bot {
        height: 40px;
        margin-top: 20px;
        margin-bottom: 20px;
    }

    .input-text {
        height: 40px;
        border-radius: 10px;

    }

    .btn-send {
        height: 40px;
        border-radius: 10px;
    }

    .msg-li {
        /*display: flex;*/
        /*font-size: 0px;*/
    }

    .username {
        /*display: inline-block;*/
        font-size: 15px;
        border-radius: 30px;
        background-color: pink;
        width: 50px;
        height: 50px;
        line-height: 50px;
        text-align: center;
        vertical-align: middle;
        color: #fff;
        border: 1px solid #007bff;
    }

    .span {
        /*flex: 1;*/
    }

    .msg-text {
        font-size: 20px;
    }

    .time-text {
        font-size: 10px;
    }

</style>
<body>
<div class="container-fluid min-vh-100">
    <div class="name">
        <h2>Chat Room</h2>
    </div>
    <div class="top">
        <div class="info row" id="chat">
            <!--            <div class="col-5 row" style="padding-left: 30px;">-->
            <!--                <div class="username col-2 rounded-circle" style="width: 50px;height:50px;padding:0px;flex:none;">${username}</div>-->
            <!--                <div class="span col-10 text-left">-->
            <!--                    <div class="msg-text row">${message}</div>-->
            <!--                    <div class="time-text row">${date}</div>-->
            <!--                </div>-->
            <!--            </div>-->
            <!--            <div class="col-2 row">-->
            <!--                <div class="span col-10 text-center">-->
            <!--                    <div class="msg-text row">${message}</div>-->
            <!--                    <div class="time-text row">${date}</div>-->
            <!--                </div>-->
            <!--            </div>-->
            <!--            <div class="col-5 row">-->
            <!--                <div class="span col-10 flex ">-->
            <!--                    <div class="msg-text row " style="justify-content: flex-end">-->
            <!--                        <div class="text-right">${message}</div>-->
            <!--                    </div>-->
            <!--                    <div class="time-text row text-right" style="justify-content: flex-end">-->
            <!--                        <div class="text-right">${date}</div>-->
            <!--                    </div>-->
            <!--                </div>-->
            <!--                <div class="username col-2 rounded-circle" style="width: 50px;height:50px;padding:0px;flex:none;">${username}</div>-->
            <!--            </div>-->
        </div>
        <!--        <ul class="info col-sm-2" id="loginInfo">-->
        <!--            -->
        <!--        </ul>-->
        <!--        <ul class="info col-sm-5" id="me" style="float: right;">-->
        <!--        </ul>-->
    </div>
    <div class="bot col-sm-8">
        <input class="col-sm-8 input-text" type="text" id="msg">
        <button class="btn btn-success col-sm-2 btn-send " id="btn">Send</button>
    </div>
</div>
<script src="../js/jquery-3.4.1.js"></script>
<script src="../common/jquery.cookie.js"></script>
<script type="text/javascript" src="../common/jquery.tmpl.js"></script>
<script src="../common/socket.io.js"></script>
<script type="text/x-jquery-tmpl" id="message">
    <div class="col-5 row" style="padding-left: 30px;">
                {{if chat.message === undefined}}
                <div>${chat.username}</div>
                <div class="span col-10 text-left">
                    <div class="msg-text row">${chat.message}</div>
                    <div class="time-text row">${chat.date}</div>
                </div>
                {{else}}
                <div class="username col-2 rounded-circle" style="width: 50px;height:50px;padding:0px;flex:none;">${chat.username}</div>
                <div class="span col-10 text-left">
                    <div class="msg-text row">${chat.message}</div>
                    <div class="time-text row">${chat.date}</div>
                </div>
                {{/if}}
    </div>







</script>
<script>

    $(function () {

        var ws = io('ws://localhost:8002', {transport: ['websocket']});
        ws.on('connect', function (e) {
            console.log("server connect success");
        })

        // $("#message").tmpl({
        //     chat: {
        //         "username": $.cookie("username"),
        //         "message": "chat",
        //         "date": moment().format('MMMM Do YYYY, h:mm:ss')
        //     },
        //     // loginInfo: {
        //     //
        //     // },
        //     // me: {
        //     //
        //     // }
        // }).appendTo("#chat")
        // $("#message").tmpl({
        //     chat: {
        //
        //     },
        //     loginInfo: {
        //         "username": $.cookie("username"),
        //         "message": "login out",
        //         "date": moment().format('MMMM Do YYYY, h:mm:ss')
        //     },
        //     me: {
        //
        //     }
        // }).appendTo("#chat")
        // $("#message").tmpl({
        //     chat: {
        //     },
        //     loginInfo: {
        //
        //     },
        //     me: {
        //         "username": $.cookie("username"),
        //         "message": "me",
        //         "date": moment().format('MMMM Do YYYY, h:mm:ss')
        //     }
        // }).appendTo("#chat")
        $(".btn-send").click(function () {
                var msg = $("#msg").val()
                $("#message").tmpl({
                    chat: {
                        "username": $.cookie("username"),
                        "message": msg,
                        "date": moment().format('MMMM Do YYYY, h:mm:ss')
                    },
                }).appendTo("#chat")
                ws.emit('msg', msg);
                $("#msg").val('')
            },
        )


    })
</script>
</body>
</html>


<!--<div class="col-2 row">-->
<!--    <div class="span col-10 text-center">-->
<!--        <div class="msg-text row">${loginInfo.message}</div>-->
<!--        <div class="time-text row">${loginInfo.date}</div>-->
<!--    </div>-->
<!--</div>-->

<!--<div class="col-5 row" style="margin-left:75px">-->
<!--    <div class="span col-10 flex ">-->
<!--        <div class="msg-text row" style="justify-content: flex-end">-->
<!--            <div class="text-right">${me.message}</div>-->
<!--        </div>-->
<!--        <div class="time-text row text-right" style="justify-content: flex-end">-->
<!--            <div class="text-right">${me.date}</div>-->
<!--        </div>-->
<!--    </div>-->
<!--    {{if me.message === undefined}}-->
<!--    <div>${me.username}</div>-->
<!--    {{else}}-->
<!--    <div class="username col-2 rounded-circle" style="width: 50px;height:50px;padding:0px;flex:none;">${me.username}</div>-->
<!--    {{/if}}-->
<!--</div>-->
<!--// var li = $("<li></li>");-->
<!--// var username = $("<text>")-->
<!--    // var span = $("<span>")-->
<!--            // var msgText = $("<text></text>")-->
<!--            // var br = $("<br>")-->
<!--            // var time = $("<text></text>")-->
<!--            // var timezone = moment().format('MMMM Do YYYY, h:mm:ss')-->
<!--            // var name = "Garry"-->
<!--            // username.html(name)-->
<!--            // msgText.html($(".input-text").val())-->
<!--            // time.html(timezone)-->
<!--            // $(username).addClass("username")-->
<!--            // $(msgText).addClass("msg-text");-->
<!--            // $(br).css("height", 5)-->
<!--            // $(time).addClass("time-text")-->
<!--            // $(span).addClass("span")-->
<!--            // $(span).append(msgText);-->
<!--            // $(span).append(br);-->
<!--            // $(span).append(time);-->
<!--            // $(li).addClass("msg-li")-->
<!--            // $(li).append(username)-->
<!--            // $(li).append(span)-->
<!--            // $("ul").append(li);-->
<!--            // $(".input-text").val("")-->