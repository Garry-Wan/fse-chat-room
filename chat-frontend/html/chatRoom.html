<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../bootstrap/css/bootstrap.min.css">
    <script src="../js/jquery-3.4.1.js"></script>
    <script src="../js/time/moment.js"></script>
    <title>FSE Chat Room</title>
</head>
<style>
    .container-fluid {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
    }

    .name {
        margin-top: 20px;
        margin-bottom: 20px;
    }

    .top {
        width: 80%;
        border: 1px solid #000000;
        border-radius: 20px;
        flex: 1;

    }

    .info {
        /*padding-left: 20px;*/
        padding: 5px;
    }

    ul li {
        font-size: 30px;
        /*background: image();*/
    }

    .bot {
        height: 40px;
        margin-top: 20px;
        margin-bottom: 20px;
    }

    .input-text {
        height: 40px;
        border-radius: 10px;

    }

    .btn-send {
        height: 40px;
        border-radius: 10px;
    }


    .username {
        /*display: inline-block;*/
        font-size: 15px;
        border-radius: 30px;
        background-color: pink;
        width: 50px;
        height: 50px;
        line-height: 50px;
        text-align: center;
        vertical-align: middle;
        color: #fff;
        border: 1px solid #007bff;
    }

    .username-other {
        /*display: inline-block;*/
        font-size: 15px;
        border-radius: 30px;
        background-color: #b3d7ff;
        width: 50px;
        height: 50px;
        line-height: 50px;
        text-align: center;
        vertical-align: middle;
        color: #fff;
        border: 1px solid #007bff;
    }

    .msg-text {
        font-size: 20px;
    }

    .time-text {
        font-size: 10px;
    }
    .me{
        padding-top: 10px;
    }
    .other{
        display: flex;
        padding-top: 10px;
        justify-content: flex-end;
        padding-right: 0px;
    }
    .other-msg{
        padding-right: 20px;
    }
</style>
<body>
<div class="container-fluid min-vh-100">
    <div class="name">
        <h2>Chat Room</h2>
    </div>
    <div class="top">
        <div class="info row" id="chat">
        </div>
    </div>
    <div class="bot col-sm-8">
        <input class="col-sm-8 input-text" type="text" id="msg">
        <button class="btn btn-success col-sm-2 btn-send " id="btn">Send</button>
    </div>
</div>
<script src="../js/jquery-3.4.1.js"></script>
<script src="../common/jquery.cookie.js"></script>
<script type="text/javascript" src="../common/jquery.tmpl.js"></script>
<script src="../common/socket.io.js"></script>
<script type="text/x-jquery-tmpl" id="message">
   {{if chat.username == "me"}}
        <div class="col-12 row me" style="padding-left: 30px;">
                <div class="username">${chat.username}</div>
                <div class="span col-10 text-left">
                    <div class="msg-text row">${chat.message}</div>
                        <div class="time-text row">${chat.date}</div>
                </div>
        </div>
    {{else}}
         <div class="col-12 row other ">
            <div class="span text-right other-msg">
                <div class="msg-text row text-right">${chat.message}</div>
                <div class="time-text row text-right">${chat.date}</div>
            </div>
            <div class="username-other">${chat.username}</div>
        {{/if}}
   </div>

</script>
<script>

    $(function () {
        var ws = io('ws://localhost:8002', {transport: ['websocket']});
        ws.on('connect', function (e) {
            console.log("server connect success");
            ws.emit('login', {username: $.cookie("username")})
        })
        ws.on('receiveMsg', function (data) {
            console.log("receiveMsg from server")
            if (data.username == $.cookie("username") )
            {
                $("#message").tmpl({
                    chat: {
                        "username": "me",
                        "message": data.msg,
                        "date": moment().format('MMMM Do YYYY, h:mm:ss')
                    },
                }).appendTo("#chat")

            }
            else {
                $("#message").tmpl({
                    chat: {
                        "username": data.username,
                        "message": data.msg,
                        "date": moment().format('MMMM Do YYYY, h:mm:ss')
                    },
                }).appendTo("#chat")

            }

        })

        // $("#message").tmpl({
        //     chat: {
        //         "username": $.cookie("username"),
        //         "message": "chat",
        //         "date": moment().format('MMMM Do YYYY, h:mm:ss')
        //     },
        //     // loginInfo: {
        //     //
        //     // },
        //     // me: {
        //     //
        //     // }
        // }).appendTo("#chat")
        // $("#message").tmpl({
        //     chat: {
        //
        //     },
        //     loginInfo: {
        //         "username": $.cookie("username"),
        //         "message": "login out",
        //         "date": moment().format('MMMM Do YYYY, h:mm:ss')
        //     },
        //     me: {
        //
        //     }
        // }).appendTo("#chat")
        // $("#message").tmpl({
        //     chat: {
        //     },
        //     loginInfo: {
        //
        //     },
        //     me: {
        //         "username": $.cookie("username"),
        //         "message": "me",
        //         "date": moment().format('MMMM Do YYYY, h:mm:ss')
        //     }
        // }).appendTo("#chat")
        $(".btn-send").click(function () {
                var usermsg = $("#msg").val()
                if (!usermsg) {
                    showMessage(" msg should not be empty")
                    return;
                }
                ws.emit('sendMsg', {username: $.cookie("username"), msg: $("#msg").val()});
                $("#msg").val('')
            },
        )
    })
</script>
</body>
</html>
